{% extends base_template %}

{% block title %}Books{% endblock %}

{% block content %}
{% if isManager %}
	<input id="count" name="count" value="{{count}}"/>
	<a href = "/bookstore/3/" id="search">Search</a>
	
	<h4>popular books</h4>
	{% for book in pop_book %}
	ISBN: {{book.ISBN}}
	title: {{book.title}}
	<p></p>
	{% endfor %}
	<h4>popular authors</h4>
	{% for author in pop_author %}
	{{author.author}}
	<p></p>
	{% endfor %}
	<h4>popular publishers</h4>
	{% for publisher in pop_publisher %}
	{{publisher.publisher}}
	<p></p>
	{% endfor %}
{% else %}

<h2>Account</h2> 

<div class="well" style="height:300px">
<h6><a type="button" id="editlink" href="#">edit account info</a></h6>
    <div id="accountInfo" class="show">
	{% for user in user_info %}
	<h5 class="list-group-item-heading">username {{user.username}}</h5>
	<h5 class="list-group-item-heading">fullname: {{user.fullname}}</h5>
	<h5 class="list-group-item-heading">phone number: {{user.phone}}</h5>
	<h5 class="list-group-item-heading">card number: {{user.card}}</h5>
	<h5 class="list-group-item-heading">address: {{user.address}}</h5>
	{% endfor %}
	</div>
	<div id="editAccountInfo" class="hidden">
	{% if edited %}
		{% for user in user_info %}
		<h5 class="list-group-item-heading">username: {{user.username}}</h5>
		<h5 class="list-group-item-heading">fullname: {{user.fullname}}</h5>
		<h5 class="list-group-item-heading">phone number: {{user.phone}}</h5>
		<h5 class="list-group-item-heading">card number: {{user.card}}</h5>
		<h5 class="list-group-item-heading">address: {{user.address}}</h5>
		{% endfor %}
	{% else %}
		<form id="user_form" method="post" action="/bookstore/account/"
		        enctype="multipart/form-data">
		    {% csrf_token %}
		    {% for field in user_form %}
   				<h6 style="color:red">{{field.errors}}</h6>
   				<div class="input-group">
   				<label for="{{ field.id_for_label }}" class="sr-only">{{ field.label_tag }}</label>
   				<span class="input-group-addon glyphicon glyphicon-pencil" aria-hidden="true"></span>
   				{{field}}
				</div>
   			{% endfor %}<br>
		    <input class="btn btn-success" type="submit" name="submit" value="Save" />
		</form>
	{% endif %}
	</div>
</div>

	<h2>My feedback</h2>
    
	{% for feedback in feedback_list %}
	<h5 class="list-group-item-heading">book:{{feedback.title}}</h4>
	<h5 class="list-group-item-heading">score:{{feedback.score}}</h5>
	<h5 class="list-group-item-heading">text:{{feedback.text}}</h5>
	<h5 class="list-group-item-heading">text:{{feedback.date}}</h5>
	{% endfor %}

	<h2>My rating</h2>

	{% for rating in rate_list %}
	<h5 class="list-group-item-heading">user:{{rating.customer_id}}</h4>
	<h5 class="list-group-item-heading">book::{{rating.title}}</h5>
	<h5 class="list-group-item-heading">text:{{rating.text}}</h5>
	<h5 class="list-group-item-heading">rating:{{rating.rate}}</h5>
	{% endfor %}
{% endif %}


<script type="text/javascript">

$("#count").bind("change", function() {
   $("#search").attr("href", "/bookstore/account/"+$(this).val())
});

$('#editlink').on('click', function () {
	var text = $('#editlink').text();
	$(this).text(text == 'return to account info' ? 'edit account info' : 'return to account info');
	if (text == 'return to account info'){
		$("#accountInfo").removeClass('hidden');
	}
	else{
		$("#accountInfo").addClass('hidden');
	}
    $("#editAccountInfo").toggleClass('hidden');
 });

</script>
{% endblock %}